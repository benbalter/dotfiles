#!/bin/sh

title () {
  echo "\n"
  echo "-------------------------------"
  echo $1
  echo "-------------------------------"
  echo "\n"
}

link() {
  username=$(whoami)
  if [ ! -f ~/$1 ] || [ $(ls -l ~/$1 | awk '{print $11}') != "/Users/$username/.files/$1" ]; then
    echo "Linking ~/$1 to ~/.files/$1"
    ln -sf ~/.files/$1 ~/$1
  fi
}

if [ ! -d ~/.oh-my-zsh ]; then
  title "Setting up zsh"
  sh -c "$(wget https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O -)"
  rm -f .zshrc
  curl -L https://iterm2.com/misc/zsh_startup.in > ~/.iterm2_shell_integration.zsh
  chmod +x ~/.iterm2_shell_integration.zsh
fi

link .bash_profile
link .gitconfig
link .gitignore
link .irbrc
link .zshrc
link .Brewfile

if [ ! -d ~/projects ]; then
  echo "Creating project directory"
  mkdir ~/projects
fi

if ! type "brew" > /dev/null; then
  title "Installing homebrew..."
  ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
  brew tap homebrew/bundle
fi

title "Setting up Homebrew..."
if ! brew bundle check --global; then
  brew bundle install --global
fi

title "Setting up atom..."
link .atom/config.cson
apm install --packages-file ~/.files/.atom/packages.txt


title "Fin."
